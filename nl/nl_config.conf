#!/bin/bash
# ========================================
# JOB CONFIGURATION FILE
# ========================================
# Edit this file to configure your experiment parameters
# Then run: ./submit_wrapper.sh job_config.conf

# Task configuration
TASK="si"                        # Options: si, dfs, search
ACCURACY_THRESHOLD="0.98"
BASE_ALPHA="0.6"
LORA_RANK="16"
LORA_DROPOUT="0.1"
MAX_INPUT_SIZE="128"
MAX_LOOKAHEAD="12"
REQUESTED_BACKTRACK="3"
MAX_FRONTIER_SIZE="12"
MAX_BRANCH_SIZE="12"
USE_LORA="true"
NUM_SHOTS="0"                     # 0, 1, or 2

# Curriculum learning parameters
N_STAGES="5"
MIN_STEPS_PER_STAGE="100"
CHECK_EVERY="50"

# Training parameters
BATCH_SIZE="16"
GRADIENT_ACCUMULATION_STEPS="1"
LEARNING_RATE="2e-5"
WARMUP_STEPS="500"
MIN_BATCH_SIZE="1"                # For OOM handling
FIRST_TOKEN="1.0"               # Soft weight for the first token

# Evaluation parameters
EVAL_SAMPLES="500"
EVAL_BATCH_SIZE="8"
EVAL_AFTER_STAGE="true"          # Evaluate after each stage
PRINT_EVAL_EXAMPLES="1"           # Number of examples to print

# Diagnostic parameters (optional)
DIAGNOSTIC_STAGES=""  # Stages to run diagnostics
ALIGN_DEBUG="0"                  # Number of alignment examples to print

# Model configuration
MODEL_NAME="Qwen/Qwen3-4B-Instruct-2507"
USE_FLASH_ATTENTION="true"

# SLURM resource configuration
SLURM_MEM="64G"
SLURM_GPUS="1"
SLURM_TIME="12:00:00"
SLURM_PARTITION="ai"
SLURM_CPUS="14"
SLURM_ACCOUNT="asaparov"
SLURM_QOS="normal"
# SLURM_MAIL_USER=""              # Uncomment and set if you want email notifications
# SLURM_MAIL_TYPE="END"           # Uncomment if using mail

# Directory configuration
CACHE_DIR="/scratch/gautschi/huan2073/model_cache"
OUTPUT_BASE_DIR="/scratch/gautschi/huan2073"  # Will append job ID

# Environment configuration
HF_TOKEN=""
CONDA_ENV="search"
CUDA_MODULE="cuda/12.6.0"

# Optional: Disable curriculum learning
# NO_CURRICULUM="true"            # Uncomment to disable curriculum learning

SANITY_A="false"    # A: Replace eval labels with random labels
SANITY_B="false"   # B: Shuffle label<->input pairing at eval
SANITY_C="false"        # C: Mask/strip the goal clause in eval prompts
SANITY_D="false"